{
  "title": "Комплексный Поток Данных",
  "description": "Пример сложного потока данных с несколькими компонентами",
  "blocks": [
    {
      "id": "client-input",
      "title": "Пользовательский Ввод",
      "icon": "fa-keyboard",
      "description": "Пользователь вводит запрос в UI: \"Программирование Python Москва\".",
      "details": {
        "explanation": "Пользователь взаимодействует с приложением через интерфейс пользователя.",
        "tasks": [
          "Ввод текста в поле поиска",
          "Выбор фильтров поиска",
          "Нажатие на кнопку 'Поиск'"
        ]
      },
      "inputData": {
        "title": "Входные данные",
        "description": "",
        "format": "text",
        "data": ""
      },
      "outputData": {
        "title": "Результат: Отправляемый HTTP Запрос",
        "description": "Frontend формирует и отправляет этот запрос к API Gateway.",
        "format": "http",
        "data": "GET /api/v1/search/users?query=%D0%9F%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5+Python+%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B0&page=1 HTTP/1.1\nHost: my-interest-app.com\nUser-Agent: Mozilla/5.0\nAccept: application/json\nAccept-Language: ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7\nAuthorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\nReferer: https://my-interest-app.com/search\nConnection: keep-alive"
      }
    },
    {
      "id": "api-gateway",
      "title": "API Gateway",
      "icon": "fa-door-open",
      "description": "Прием HTTP запроса. Аутентификация. Rate Limiting. Маршрутизация.",
      "details": {
        "explanation": "API Gateway принимает и обрабатывает запросы, а затем направляет их соответствующим сервисам.",
        "tasks": [
          "Проверка валидности токена авторизации",
          "Проверка лимитов запросов",
          "Определение назначения - Search Service",
          "Извлечение user_id из токена"
        ]
      },
      "inputData": {
        "title": "Полученные данные (от Frontend)",
        "description": "Входящий HTTP GET запрос.",
        "format": "http",
        "data": "GET /api/v1/search/users?query=%D0%9F%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5+Python+%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B0&page=1 HTTP/1.1\nHost: my-interest-app.com\nUser-Agent: Mozilla/5.0\nAccept: application/json\nAccept-Language: ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7\nAuthorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\nReferer: https://my-interest-app.com/search\nConnection: keep-alive"
      },
      "outputData": {
        "title": "Результат: Передаваемый Внутренний Запрос",
        "description": "API Gateway вызывает внутренний эндпоинт Search Service.",
        "format": "http",
        "data": "POST /internal/search HTTP/1.1\nHost: search-service.internal:8080\nContent-Type: application/json\nX-Request-ID: abc-123-xyz-789\nX-User-ID: user-auth-john-doe-12345\nX-User-Roles: USER,PREMIUM\n\n{\n  \"query\": \"Программирование Python Москва\",\n  \"filters\": {},\n  \"pagination\": {\n    \"page\": 1,\n    \"limit\": 10\n  }\n}"
      }
    },
    {
      "id": "search-service",
      "title": "Search Service",
      "icon": "fa-magnifying-glass",
      "description": "Парсинг входных данных. Построение запроса к Search Engine.",
      "details": {
        "explanation": "Search Service анализирует запрос и формирует оптимизированный запрос к поисковому движку.",
        "tasks": [
          "Извлечение параметров query, pagination, user_context",
          "Формирование запроса для Elasticsearch",
          "Оптимизация поискового запроса",
          "Добавление фильтров и сортировки"
        ]
      },
      "inputData": {
        "title": "Полученные данные (от API Gateway)",
        "description": "Внутренний запрос (тело HTTP POST).",
        "format": "json",
        "data": "{\n  \"query\": \"Программирование Python Москва\",\n  \"filters\": {},\n  \"pagination\": {\n    \"page\": 1,\n    \"limit\": 10\n  },\n  \"user_context\": {\n     \"user_id\": \"user-auth-john-doe-12345\",\n     \"roles\": [\"USER\", \"PREMIUM\"]\n  }\n}"
      },
      "outputData": {
        "title": "Результат: Отправляемый Запрос к Elasticsearch",
        "description": "JSON-запрос, отправляемый к Elasticsearch.",
        "format": "json",
        "data": "{\n  \"from\": 0,\n  \"size\": 10,\n  \"_source\": false,\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"multi_match\": {\n            \"query\": \"Программирование Python Москва\",\n            \"fields\": [\n              \"profile.interests^3\",\n              \"profile.about_me\",\n              \"profile.location.city^2\",\n              \"user.full_name\"\n            ],\n            \"type\": \"best_fields\",\n            \"fuzziness\": \"AUTO\",\n            \"prefix_length\": 2\n          }\n        }\n      ],\n      \"filter\": [\n        { \"term\": { \"status\": \"active\" } },\n        { \"range\": { \"profile.age\": { \"gte\": 18 } } }\n      ]\n    }\n  },\n  \"sort\": [\n    { \"_score\": { \"order\": \"desc\" } },\n    { \"last_active_at\": { \"order\": \"desc\" } }\n  ]\n}"
      }
    },
    {
      "id": "search-engine",
      "title": "Search Engine (Elasticsearch)",
      "icon": "fa-server",
      "description": "Выполнение запроса. Поиск по индексам. Ранжирование.",
      "details": {
        "explanation": "Поисковый движок выполняет запрос по индексированным данным и возвращает релевантные результаты.",
        "tasks": [
          "Обработка запроса и его валидация",
          "Выполнение поиска по индексам",
          "Ранжирование результатов по релевантности",
          "Применение фильтров и сортировки",
          "Формирование ответа с результатами"
        ]
      },
      "inputData": {
        "title": "Полученные данные (от Search Service)",
        "description": "Elasticsearch Query DSL.",
        "format": "json",
        "data": "{\n  \"from\": 0,\n  \"size\": 10,\n  \"_source\": false,\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"multi_match\": {\n            \"query\": \"Программирование Python Москва\",\n            \"fields\": [\n              \"profile.interests^3\",\n              \"profile.about_me\",\n              \"profile.location.city^2\",\n              \"user.full_name\"\n            ],\n            \"type\": \"best_fields\",\n            \"fuzziness\": \"AUTO\",\n            \"prefix_length\": 2\n          }\n        }\n      ],\n      \"filter\": [\n        { \"term\": { \"status\": \"active\" } },\n        { \"range\": { \"profile.age\": { \"gte\": 18 } } }\n      ]\n    }\n  },\n  \"sort\": [\n    { \"_score\": { \"order\": \"desc\" } },\n    { \"last_active_at\": { \"order\": \"desc\" } }\n  ]\n}"
      },
      "outputData": {
        "title": "Результат: Elasticsearch Response",
        "description": "Ответ Elasticsearch с найденными документами.",
        "format": "json",
        "data": "{\n  \"took\": 25,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 5,\n    \"successful\": 5,\n    \"skipped\": 0,\n    \"failed\": 0\n  },\n  \"hits\": {\n    \"total\": {\n      \"value\": 42,\n      \"relation\": \"eq\"\n    },\n    \"max_score\": 15.123456,\n    \"hits\": [\n      {\n        \"_index\": \"users_v2\",\n        \"_type\": \"_doc\",\n        \"_id\": \"user_567\",\n        \"_score\": 15.123456,\n        \"fields\": {\n          \"user.id\": [\"user_567\"],\n          \"user.full_name\": [\"Иван Петров\"],\n          \"profile.title\": [\"Python Developer\"],\n          \"profile.location.city\": [\"Москва\"],\n          \"profile.skills\": [\"Python\", \"Django\", \"Flask\", \"SQL\"],\n          \"last_active_at\": [\"2023-11-15T14:35:12Z\"]\n        }\n      },\n      {\n        \"_index\": \"users_v2\",\n        \"_type\": \"_doc\",\n        \"_id\": \"user_789\",\n        \"_score\": 14.987654,\n        \"fields\": {\n          \"user.id\": [\"user_789\"],\n          \"user.full_name\": [\"Анна Иванова\"],\n          \"profile.title\": [\"Senior Python Developer\"],\n          \"profile.location.city\": [\"Москва\"],\n          \"profile.skills\": [\"Python\", \"FastAPI\", \"MongoDB\", \"AWS\"],\n          \"last_active_at\": [\"2023-11-14T18:22:45Z\"]\n        }\n      }\n    ]\n  }\n}"
      }
    },
    {
      "id": "search-service-response",
      "title": "Search Service (Формирование Ответа)",
      "icon": "fa-file-code",
      "description": "Обработка результатов поиска. Форматирование ответа для клиента.",
      "details": {
        "explanation": "Search Service преобразует результаты из Elasticsearch в формат, понятный клиенту, обогащает данные и подготавливает ответ.",
        "tasks": [
          "Получение результатов из Elasticsearch",
          "Преобразование формата данных",
          "Добавление метаинформации о поиске",
          "Формирование окончательного ответа"
        ]
      },
      "inputData": {
        "title": "Полученные данные (от Elasticsearch)",
        "description": "Ответ Elasticsearch с документами.",
        "format": "json",
        "data": "{\n  \"took\": 25,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 5,\n    \"successful\": 5,\n    \"skipped\": 0,\n    \"failed\": 0\n  },\n  \"hits\": {\n    \"total\": {\n      \"value\": 42,\n      \"relation\": \"eq\"\n    },\n    \"max_score\": 15.123456,\n    \"hits\": [\n      {\n        \"_index\": \"users_v2\",\n        \"_type\": \"_doc\",\n        \"_id\": \"user_567\",\n        \"_score\": 15.123456,\n        \"fields\": {\n          \"user.id\": [\"user_567\"],\n          \"user.full_name\": [\"Иван Петров\"],\n          \"profile.title\": [\"Python Developer\"],\n          \"profile.location.city\": [\"Москва\"],\n          \"profile.skills\": [\"Python\", \"Django\", \"Flask\", \"SQL\"],\n          \"last_active_at\": [\"2023-11-15T14:35:12Z\"]\n        }\n      },\n      {\n        \"_index\": \"users_v2\",\n        \"_type\": \"_doc\",\n        \"_id\": \"user_789\",\n        \"_score\": 14.987654,\n        \"fields\": {\n          \"user.id\": [\"user_789\"],\n          \"user.full_name\": [\"Анна Иванова\"],\n          \"profile.title\": [\"Senior Python Developer\"],\n          \"profile.location.city\": [\"Москва\"],\n          \"profile.skills\": [\"Python\", \"FastAPI\", \"MongoDB\", \"AWS\"],\n          \"last_active_at\": [\"2023-11-14T18:22:45Z\"]\n        }\n      }\n    ]\n  }\n}"
      },
      "outputData": {
        "title": "Результат: Ответ API для Клиента",
        "description": "Форматированный ответ API для отправки клиенту.",
        "format": "json",
        "data": "{\n  \"results\": [\n    {\n      \"id\": \"user_567\",\n      \"name\": \"Иван Петров\",\n      \"title\": \"Python Developer\",\n      \"location\": \"Москва\",\n      \"skills\": [\"Python\", \"Django\", \"Flask\", \"SQL\"],\n      \"lastActive\": \"2023-11-15T14:35:12Z\",\n      \"relevanceScore\": 15.123456\n    },\n    {\n      \"id\": \"user_789\",\n      \"name\": \"Анна Иванова\",\n      \"title\": \"Senior Python Developer\",\n      \"location\": \"Москва\",\n      \"skills\": [\"Python\", \"FastAPI\", \"MongoDB\", \"AWS\"],\n      \"lastActive\": \"2023-11-14T18:22:45Z\",\n      \"relevanceScore\": 14.987654\n    }\n  ],\n  \"meta\": {\n    \"total\": 42,\n    \"page\": 1,\n    \"limit\": 10,\n    \"queryTime\": 25,\n    \"nextPage\": \"/api/v1/search/users?query=Программирование+Python+Москва&page=2\"\n  }\n}"
      }
    },
    {
      "id": "api-gateway-response",
      "title": "API Gateway (Ответ Клиенту)",
      "icon": "fa-reply",
      "description": "Принятие ответа от Search Service. Отправка ответа клиенту.",
      "details": {
        "explanation": "API Gateway возвращает результаты поиска клиенту вместе с заголовками, метриками и кешированием.",
        "tasks": [
          "Добавление заголовков кеширования",
          "Добавление заголовков CORS",
          "Добавление заголовков безопасности",
          "Запись метрик и логов",
          "Отправка окончательного ответа клиенту"
        ]
      },
      "inputData": {
        "title": "Полученные данные (от Search Service)",
        "description": "Ответ от внутреннего сервиса поиска.",
        "format": "json",
        "data": "{\n  \"results\": [\n    {\n      \"id\": \"user_567\",\n      \"name\": \"Иван Петров\",\n      \"title\": \"Python Developer\",\n      \"location\": \"Москва\",\n      \"skills\": [\"Python\", \"Django\", \"Flask\", \"SQL\"],\n      \"lastActive\": \"2023-11-15T14:35:12Z\",\n      \"relevanceScore\": 15.123456\n    },\n    {\n      \"id\": \"user_789\",\n      \"name\": \"Анна Иванова\",\n      \"title\": \"Senior Python Developer\",\n      \"location\": \"Москва\",\n      \"skills\": [\"Python\", \"FastAPI\", \"MongoDB\", \"AWS\"],\n      \"lastActive\": \"2023-11-14T18:22:45Z\",\n      \"relevanceScore\": 14.987654\n    }\n  ],\n  \"meta\": {\n    \"total\": 42,\n    \"page\": 1,\n    \"limit\": 10,\n    \"queryTime\": 25,\n    \"nextPage\": \"/api/v1/search/users?query=Программирование+Python+Москва&page=2\"\n  }\n}"
      },
      "outputData": {
        "title": "Результат: HTTP Ответ Клиенту",
        "description": "Полный HTTP ответ, отправляемый клиенту.",
        "format": "http",
        "data": "HTTP/1.1 200 OK\nContent-Type: application/json; charset=utf-8\nContent-Length: 617\nCache-Control: max-age=60, public\nX-Request-ID: abc-123-xyz-789\nX-RateLimit-Limit: 100\nX-RateLimit-Remaining: 99\nX-RateLimit-Reset: 1699971789\nAccess-Control-Allow-Origin: *\nStrict-Transport-Security: max-age=31536000; includeSubDomains\nDate: Mon, 14 Nov 2023 12:34:56 GMT\n\n{\n  \"results\": [\n    {\n      \"id\": \"user_567\",\n      \"name\": \"Иван Петров\",\n      \"title\": \"Python Developer\",\n      \"location\": \"Москва\",\n      \"skills\": [\"Python\", \"Django\", \"Flask\", \"SQL\"],\n      \"lastActive\": \"2023-11-15T14:35:12Z\"\n    },\n    {\n      \"id\": \"user_789\",\n      \"name\": \"Анна Иванова\",\n      \"title\": \"Senior Python Developer\",\n      \"location\": \"Москва\",\n      \"skills\": [\"Python\", \"FastAPI\", \"MongoDB\", \"AWS\"],\n      \"lastActive\": \"2023-11-14T18:22:45Z\"\n    }\n  ],\n  \"meta\": {\n    \"total\": 42,\n    \"page\": 1,\n    \"limit\": 10,\n    \"nextPage\": \"/api/v1/search/users?query=Программирование+Python+Москва&page=2\"\n  }\n}"
      }
    },
    {
      "id": "client-display",
      "title": "Отображение в UI",
      "icon": "fa-display",
      "description": "Обработка ответа API. Отображение результатов пользователю.",
      "details": {
        "explanation": "Frontend обрабатывает полученные данные и отображает их в пользовательском интерфейсе.",
        "tasks": [
          "Обработка JSON-ответа",
          "Рендеринг списка результатов",
          "Отображение пагинации",
          "Обработка пустого результата или ошибок",
          "Предоставление возможности дальнейшей фильтрации результатов"
        ]
      },
      "inputData": {
        "title": "Полученные данные (от API Gateway)",
        "description": "HTTP-ответ от API.",
        "format": "http",
        "data": "HTTP/1.1 200 OK\nContent-Type: application/json; charset=utf-8\nContent-Length: 617\nCache-Control: max-age=60, public\nX-Request-ID: abc-123-xyz-789\nX-RateLimit-Limit: 100\nX-RateLimit-Remaining: 99\nX-RateLimit-Reset: 1699971789\nAccess-Control-Allow-Origin: *\nStrict-Transport-Security: max-age=31536000; includeSubDomains\nDate: Mon, 14 Nov 2023 12:34:56 GMT\n\n{\n  \"results\": [\n    {\n      \"id\": \"user_567\",\n      \"name\": \"Иван Петров\",\n      \"title\": \"Python Developer\",\n      \"location\": \"Москва\",\n      \"skills\": [\"Python\", \"Django\", \"Flask\", \"SQL\"],\n      \"lastActive\": \"2023-11-15T14:35:12Z\"\n    },\n    {\n      \"id\": \"user_789\",\n      \"name\": \"Анна Иванова\",\n      \"title\": \"Senior Python Developer\",\n      \"location\": \"Москва\",\n      \"skills\": [\"Python\", \"FastAPI\", \"MongoDB\", \"AWS\"],\n      \"lastActive\": \"2023-11-14T18:22:45Z\"\n    }\n  ],\n  \"meta\": {\n    \"total\": 42,\n    \"page\": 1,\n    \"limit\": 10,\n    \"nextPage\": \"/api/v1/search/users?query=Программирование+Python+Москва&page=2\"\n  }\n}"
      },
      "outputData": {
        "title": "Результат: Обновление UI",
        "description": "Обновление пользовательского интерфейса с полученными данными.",
        "format": "text",
        "data": "1. Отображение заголовка поиска: 'Результаты для \"Программирование Python Москва\"'\n2. Отображение 2 результатов поиска в виде карточек пользователей\n3. Отображение пагинации (1 из 5 страниц)\n4. Показ дополнительных фильтров для уточнения результатов"
      }
    }
  ],
  "connections": [
    {
      "from": "client-input",
      "to": "api-gateway",
      "label": "Frontend → API Gateway"
    },
    {
      "from": "api-gateway",
      "to": "search-service",
      "label": "API Gateway → Search Service"
    },
    {
      "from": "search-service",
      "to": "search-engine",
      "label": "Search Service → Elasticsearch"
    },
    {
      "from": "search-engine",
      "to": "search-service-response",
      "label": "Elasticsearch → Search Service"
    },
    {
      "from": "search-service-response",
      "to": "api-gateway-response",
      "label": "Search Service → API Gateway"
    },
    {
      "from": "api-gateway-response",
      "to": "client-display",
      "label": "API Gateway → Frontend"
    }
  ]
} 